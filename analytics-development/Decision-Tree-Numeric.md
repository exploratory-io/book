# <%= model %>を使った<%= target %>と選択された予測変数の関係の分析

目的変数である<%= target %>と選択された予測変数との関係を調べるために決定木を使った予測モデルが作られました。

# サマリ

## 予測精度

{{summary}}
{start_show_hide}
## 主要な統計指標

* R2乗
  * R2乗は目的変数の値のばらつきのうち、このモデルに使われている予測変数によって説明される割合を示します。
  * 値は0から1の間で、1はモデルが完全に目的変数の値を予測できることを意味します。
  * 一般的に0.8以上で非常に高い、0.6～0.8で高い、0.4～0.6で中程度、0.2～0.4で低い、0.2未満で非常に低いモデル適合度と解釈されることが多いです。

* RMSE
  * RMSEは平均二乗誤差の平方根を表し、予測値と実測値の誤差の大きさを測定します。
  * 目的変数と同じ単位で表されるため解釈しやすく、値が小さいほど予測精度が高いことを意味します。
  * 0以上の値を取り、完璧な予測であれば0になります。

<!-- 行数についての説明は必要か判断いただきたい。 -->
* 行数
  * 行数は分析に使用したデータの総数（サンプルサイズ）を示します。
  * データ数が多いほど、モデルの信頼性が高まりますが、計算コストも増加します。
{end_show_hide}

**<%= target %>のばらつきの説明能力**

<% if (r_square > 0.8) { %>
R2乗は<%= r_square_pct %>% (<%= r_square %>)と非常に高く、これは選択された予測変数で<%= target %>のばらつきのほとんどを説明できることを示しています。
<% } else if (r_square > 0.6) { %>
R2乗は<%= r_square_pct %>% (<%= r_square %>)と高く、これは選択された予測変数で<%= target %>のばらつきをうまく説明できることを示しています。
<% } else if (r_square > 0.4) { %>
R2乗は<%= r_square_pct %>% (<%= r_square %>)と中程度ですが、選択された予測変数で<%= target %>のばらつきをそれなりに説明できることを示しています。
<% } else if (r_square > 0.2) { %>
R2乗は<%= r_square_pct %>% (<%= r_square %>)と低いですが、選択された予測変数で<%= target %>のばらつきのある程度の傾向は捉えているが、重要な予測変数が抜けている可能性があります。
<% } else { %>
R2乗は<%= r_square_pct %>% (<%= r_square %>)と非常に低いため、選択された予測変数では<%= target %>のばらつきはあまり説明できていません。
<% } %>

**予測精度**

RMSE（平均二乗誤差のルート）は<%= rmse %>で、これはこの予測モデルを使って元データを予測したときの予測値と実際の値の間の平均的な誤差を示しています。

## 選択された予測変数と<%= target %>の関係の強さ

選択された予測変数と<%= target %>の関係の強さを相対的に表したのが以下のチャートです。

{{variable_importance}}

## それぞれの予測変数と<%= target %>の関係

それぞれの予測変数の値が変わると、<%= target %>の値がどのように変わるかを表したのが以下のチャートです。変数は<%= target %>との関係が最も強いものから弱い方への順番で並んでいます。

{{variable_effect_numeric}}

## 決定木の構造

以下のチャートは、作成された決定木の構造を可視化したもので、<%= target %>を予測する際に作られた条件分岐を確認することができます。

{{tree_structure}}

**決定木の読み方**

- **ノードとブランチ**: 各ボックスはノード（決定点または葉）を表し、そこから伸びる線はブランチ（枝）と呼ばれる分岐を示しています。
- **条件分岐**: 各内部ノードには分割する際の条件（例：「変数A < 値X」）が表示されており、この条件に基づいて左右に分岐します。
 - 左側のブランチは条件が「yes（真）」の場合
 - 右側のブランチは条件が「no（偽）」の場合

**ノード内の情報**

各ノードには以下の情報が含まれています。

- **上段の数値**: そのノードでの予測値（そのノードに含まれるサンプルの<%= target %>の平均値）
- **下段のパーセンテージ**: 全体に対するそのノードに含まれるサンプルの割合（%）

# 次のステップ

* 変数選択の最適化：変数重要度が低い予測変数を除外して、モデルをシンプルにすることを検討してください。これにより、モデルの解釈がしやすくなり、過剰適合のリスクも減少します。
* 外れ値の確認：予測精度に影響を与える可能性のある外れ値がないか確認し、必要に応じて対処することで、モデルの信頼性が向上する可能性があります。
* パラメータの調整：決定木のパラメータ（木の深さ、分岐による改善率の最小値など）を調整することで、モデルの性能をさらに向上させることができるかもしれません。
* アンサンブル学習の手法の検討：単一の決定木では捉えられないパターンを捉えるために、ランダムフォレストやXGBoostといったアンサンブル学習の手法を検討することも有効かもしれません。

# 補足情報

## トレーニングデータに対する予測

元のデータに対して、作成された予測モデルを使って予測した結果が以下の表となります。

{{data}}

## 実測値と予測値の関係

予測した結果、元の実測値と予測値にはズレがありますが、それらの関係を散布図を使って可視化したのが以下のチャートです。それぞれの点はそれぞれの行を表しています。

{{actual_predicted}}