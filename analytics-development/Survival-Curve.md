const template = `

観察対象である行ごとに「<%= start_date_column %>」列の値から「<%= end_date_column %>」列の値までを生存期間、「<%= event_status %>」をイベントとしたデータを元に、[カプラン・マイヤー](https://exploratory.io/note/exploratory/ITp4cVo8)のアルゴリズムを使って生存曲線を計算しました。

**注意点**

* 終了時期である<%= end_date_column %>がNA（欠損値）の場合は、デフォルトではデータの「最後の日」が使われます。他の値で埋めたい場合は、[「設定」](//analytics/settings)より変更できます。


# 生存曲線

<% if (!color_column) { %>

<% if (!group_column) { %>
経過期間ごとの生存率（<%= event_status %>が発生していない割合）を生存曲線として可視化したのが以下のチャートです。横軸は開始時点からの経過期間（単位は<%= time_unit%>）、縦軸は生存率（%）です。
<% } else { %>
経過期間ごとの生存率（<%= event_status %>が発生していない割合）を生存曲線として可視化したチャートを、<%= group_column %>ごとに表示しています。横軸は開始時点からの経過期間（単位は<%= time_unit%>）、縦軸は生存率（%）です。
<% } %>
<% } else { %>

<% if (!group_column) { %>
経過期間ごとの生存率（<%= event_status %>が発生していない割合）を、各<%= color_column %>ごとに生存曲線として可視化したのが以下のチャートです。横軸は開始時点からの経過期間（単位は<%= time_unit%>）、縦軸は生存率（%）です。
<% } else { %>
経過期間ごとの生存率（<%= event_status %>が発生していない割合）を、各<%= color_column %>ごと、<%= group_column %>ごとに生存曲線として可視化したのが以下のチャートです。横軸は開始時点からの経過期間（単位は<%= time_unit%>）、縦軸は生存率（%）です。
<% } %>

<% } %>

{{survival_curve}}

曲線が急な部分は<%= event_status %>のイベントが発生する割合が多いことを、緩やかな部分は少ないことを示します。

## 生存率の表

<% if (!color_column) { %>

<% if (!group_column) { %>
上記の生存曲線のデータを表にしたのが以下となります。各列は経過期間、各値はその時点における生存率（%）です。
<% } else { %>
上記の生存曲線のデータを表にしたのが以下となります。各列は経過期間、各行は<%= group_column %>ごと、各値はその時点における生存率（%）です。
<% } %>
<% } else { %>

<% if (!group_column) { %>
上記の生存曲線のデータを表にしたのが以下となります。各列は経過期間、各行は<%= color_column %>ごと、各値はその時点における生存率（%）です。
<% } else { %>
上記の生存曲線のデータを表にしたのが以下となります。各列は経過期間、各行は<%= color_column %>と<%= group_column %>の組み合わせごと、各値はその時点における生存率（%）です。
<% } %>

<% } %>

{{survival_table}}

# データ

各期間ごとに観察対象数、イベント発生数、打ち切りの数、生存率とその95%信頼区間を以下の表にまとめています。

{{data}}

生存率の計算のあたり、観測期間中にイベントが発生したかどうか確認できないデータを「打ち切り」と呼び、生存率の計算の対象から外します。例えば、まだ一ヶ月しか経過していない観察対象は、2ヶ月目以降イベントが起きるのかどうかまだわかりません。そこで2ヶ月目以降の計算からは対象外として外します。このようなケースを「打ち切り」と呼びます。

打ち切りに関する詳細な説明については、[こちら](https://exploratory.io/note/exploratory/ITp4cVo8)のノートをご覧ください。

# サマリ情報

<% if (color_column) { %>

## 生存曲線の有意性の検定

<%= color_column %>のグループ間の生存曲線の違いの有意性を調べるために、ログランク検定を行いました。

{{summary_chart}}

この仮説検定における帰無仮説は、「<%= color_column %>のグループ間で生存曲線に差がない」というものです。P値の値が有意水準である<%= baseline_p_pct %>%より高ければ、選択された説明変数と<%= target %>の関係は統計的に有意とは言えません。逆に、P値が<%= baseline_p_pct %>%より低ければ、有意だと言えます。

**指標の詳細**

* カイ2乗値
  * カイ2乗値は生存曲線間の差の大きさを「標準化」した統計量です。
  * 0以上の値を取り、値が大きいほど生存曲線間の差が大きいことを示します。

* P値
  * 観察された生存曲線の差（カイ2乗値）、またはそれ以上に大きな差が得られる確率です。
  * 有意水準（一般的に5%）より低ければ、統計的に有意であると判断できます。
  * P値はデータ量が多ければ小さくなり、少なければ大きくなる傾向があります。

* 自由度
  * 自由度によってカイ2乗値よりP値を算出するためのカイ2乗分布（確率分布）の形が決まります。
  * 自由度は比較するグループ数から1を引いた値になります。

* 行数
  * 行数は分析に使用した観察対象（データ）の総数（サンプルサイズ）です。

* 行数 (TRUE)
  * イベントが発生した観察対象（データ）の行数を示します。

<% } else { %>

{{summary_chart}}

* 行数
  * 行数は分析に使用した観察対象（データ）の総数（サンプルサイズ）です。

* 行数 (TRUE)
  * イベントが発生した観察対象（データ）の行数を示します。

<% } %>


# 補足情報

## 次のステップ

<% if (!color_column) { %>
* コホート分析：「色で分割」に列を割り当てることで、グループ（コホート）ごとの生存曲線を比べることで、何が生存曲線を良くするのか、または悪くするのかといったことを調べることができます。
<% } else { %>
<% if (!group_column) { %>
* グループ別分析：グループごとに生存曲線を作成することで、それぞれのグループ内での<%= event_status %>の決定要因をより詳細に分析できます。その場合は、「繰り返し」にグループとなる変数を選択し、実行し直すことができます。
<% } %>
* 生存曲線に対して<%= color_column %>という1つの変数が与える影響を分析しました。しかし、他の変数も生存曲線に影響している可能性があります。そのため、「コックス回帰」を使った多変量分析を使い、複数の要因を同時に考慮した分析をすることができます。
<% } %>


`;
module.exports = template;
