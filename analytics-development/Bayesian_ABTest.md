const template = `
# 分析結果

今回の分析では、<%= explanatory %>によって、どちらが<%= target %>が優れているかをベイジアン A/Bテストを使って調べました。

{{summary_chart}}

<% if (improve_probability > 0.95) { %>
  結果として、グループAがグループBより優れている確率は<%= 100 * improve_probability %>% (<%= improve_probability %>)で、95%の信頼度の閾値を超えています。つまり、グループAがグループBよりも優れていると高い確信を持って言えます。
  
  期待される改善率は<%= expected_improvement_pct %>% (<%= expected_improvement %>)で、確信区間は<%= confidence_lower_pct %>%から<%= confidence_upper_pct %>%の間となっています。
  
  <% if (expected_loss < 0.001) { %>
    期待される損失率は<%= expected_loss_pct %>% (<%= expected_loss %>)と非常に低く、グループAを選択することによるリスクは極めて低いと言えます。
  <% } else if (expected_loss < 0.01) { %>
    期待される損失率は<%= expected_loss_pct %>% (<%= expected_loss %>)と低く、グループAを選択することによるリスクは低いと言えます。
  <% } else { %>
    期待される損失率は<%= expected_loss_pct %>% (<%= expected_loss %>)となっています。
  <% } %>
<% } else if (improve_probability > 0.75) { %>
  結果として、グループAがグループBより優れている確率は<%= 100 * improve_probability %>% (<%= improve_probability %>)です。95%の信頼度の閾値には達していませんが、グループAがグループBよりも優れている可能性がある程度あります。
  
  期待される改善率は<%= 100 * expected_improvement %>% (<%= expected_improvement %>)で、確信区間は<%= 100 * confidence_lower %>%から<%= 100 * confidence_upper %>%の間となっています。
  
  <% if (expected_loss > 0.05) { %>
    期待される損失率は<%= expected_loss_pct %>% (<%= expected_loss %>)と比較的高く、グループAを選択することにはまだリスクがあると考えられます。
  <% } else { %>
    期待される損失率は<%= expected_loss_pct %>% (<%= expected_loss %>)となっています。
  <% } %>
<% } else if (improve_probability > 0.5) { %>
  結果として、グループAがグループBより優れている確率は<%= 100 * improve_probability %>% (<%= improve_probability %>)です。グループAとグループBの間に明確な差があるとは言えず、どちらかが優れているかについては不確実性が高いです。
  
  期待される改善率は<%= expected_improvement_pct %>% (<%= expected_improvement %>)で、確信区間は<%= confidence_lower_pct %>%から<%= confidence_upper_pct %>%の間となっています。この確信区間に0が含まれているため、改善効果がない可能性も十分にあります。
  
  期待される損失率は<%= expected_loss_pct %>% (<%= expected_loss %>)となっています。
<% } else { %>
  結果として、グループAがグループBより優れている確率は<%= 100 * improve_probability %>% (<%= improve_probability %>)です。この結果から、グループBがグループAよりも優れている可能性が高いと言えます。
  
  期待される改善率は<%= 100 * expected_improvement %>% (<%= expected_improvement %>)で、確信区間は<%= 100 * confidence_lower %>%から<%= 100 * confidence_upper %>%の間となっています。
  
  <% if (expected_loss > 0.05) { %>
    期待される損失率は<%= expected_loss_pct %>% (<%= expected_loss %>)と高く、グループAを選択することによるリスクは大きいと言えます。
  <% } else { %>
    期待される損失率は<%= expected_loss_pct %>% (<%= expected_loss %>)となっています。
  <% } %>
<% } %>

## 主要な統計指標

* 改善する確率
  * グループAがグループBより改善される確率を示します。
  * 値は0から1の間で、1に近いほどグループAが優れていることを示します。
  * ベイジアン分析では、この確率が直接計算され、どちらのバリエーション（AまたはB）が優れているかの判断材料となります。

* 期待される改善率
  * グループAがグループBと比較して改善される期待値を示します。
  * 正の値はグループAの方が優れていることを意味し、負の値はグループBの方が優れていることを意味します。
  * この値が大きいほど、改善効果が大きいことを示します。

* コンバージョン率
  * 各グループにおけるコンバージョンの発生率を示します。
  * 値は0から1の間で、1に近いほどコンバージョン率が高いことを意味します。
  * グループ間のコンバージョン率の差が改善率の基礎となります。

* 確信区間
  * 真の改善率がこの範囲内にある可能性が高いことを示す区間です。
  * 確信区間が0を含まない場合、一方のグループがもう一方より優れている可能性が高いことを示します。
  * 区間の幅が狭いほど、推定の精度が高いことを意味します。

* 期待される損失率
  * 間違った選択をした場合に失われる可能性のある改善率を示します。
  * 値が小さいほど、誤った決定によるリスクが低いことを意味します。

# 確率分布

## 改善率の分布

改善率の分布はグループAがグループBと比較してどれだけ改善されるかの確率分布を示しています。

{{improvement_distribution}}

X軸は改善率（AがBよりどれだけ優れているか）を表し、各バーの値はどれだけの確率で改善するかを表しています。

## 事後確率分布

事後確率分布はテスト後のAグループとBグループのコンバージョン率の分布を表しています。

{{distribution}}

分布が重なっていない場合や重なりが少ない場合は、グループ間の差が明確であり、どちらが優れているかについての確実性が高いことを示します。分布の位置関係から、どちらのグループのコンバージョン率が高いかを視覚的に判断することができます。

# ピボットテーブル

各グループごとのコンバージョン率のクロス集計表は以下のとおりです。

{{pivot_table}}

# 比率チャート

グループごとのコンバージョン率のバーチャートは以下のとおりです。

{{ratio}}

# 次のステップ

<% if (improve_probability > 0.95) { %>
* 実装の検討: グループAがグループBより明確に優れているため、グループAの実装を本番環境に展開することを検討してください。
<% } else if (improve_probability > 0.75) { %>
* 実装の検討: グループAがグループBより優れている可能性が高いですが、さらなるデータ収集や分析を行い、信頼性を高めることも検討してください。
<% } else if (improve_probability > 0.5) { %>
* 追加テストの実施: 現時点ではどちらのグループが優れているか明確ではないため、サンプルサイズを増やすか、テスト設計を見直して再度テストを行うことを検討してください。
<% } else { %>
* グループBの採用検討: 分析結果からはグループBの方が優れている可能性が高いため、グループBの実装を検討するか、新たなA/BテストでグループBを基準として改善策を検討してください。
<% } %>
* コンバージョン率に関係している要因を調べたい場合、「ロジスティック回帰」などを使った多変量分析を使い、複数の要因を同時に考慮した分析をすることができます。
`;

module.exports = template;