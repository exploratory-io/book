目的変数である<%= target %>の発生までの時間と選択された予測変数との関係を調べるためにコックス回帰モデルが作られました。

# 多重共線性

{{multicollinearity}}

<% if (max_vif > 10) { %>

このモデルには多重共線性（複数の予測変数間に強い相関関係があること）の問題が見られます。VIFの値が10を超えている予測変数があると、個々の変数の効果を正確に評価することが難しくなります。
この問題を解決するためには、VIFの値が10を超えている予測変数の中から必要性が低いものを1つずつ除外し、再実行し、VIFの値が10を超える予測変数がなくなるまで繰り返してください。

<% } else { %>
このモデルには多重共線性（複数の予測変数間に強い相関関係があること）の問題は見られません。（VIFの値が10を超えている予測変数があると、個々の変数の効果を正確に評価することが難しくなります。）
<% } %>


# 分析結果

## モデルの適合度と有意性

{{summary_chart}}

{start_show_hide}
# モデルの指標の詳細

* 一致係数
  * 一致係数（コンコーダンス）はモデルの予測能力を示す指標で、ランダムに選んだ2つのケースのうち、モデルが実際の生存時間順序を正しく予測できる確率を表します。
  * 値は0.5から1の間で、0.5はランダム予測と同等、1は完璧な予測を意味します。
  * 一般的に0.7以上で許容可能、0.8以上で良好な予測性能と解釈されます。

* 一致係数の標準誤差
  * 一致係数の標準誤差は、推定された一致係数の精度を示します。
  * 値が小さいほど、一致係数の推定精度が高いことを意味します。
  * 一致係数±1.96×標準誤差で95%信頼区間が計算できます。

* 時点AUC
  * 時点AUCは特定の時点におけるモデルの識別能力を示す指標です。
  * 値は0.5から1の間で、0.5はランダム予測、1は完璧な識別能力を意味します。
  * 複数の時点でのAUCを確認することで、モデルの予測性能の時間的安定性を評価できます。

* 尤度比検定
  * 尤度比検定はモデル全体の有意性を評価する統計量で、帰無モデル（予測変数なし）と比較します。
  * 値が大きいほど、モデルが統計的に意味があることを示します。
  * カイ二乗分布に従うため、自由度（予測変数の数）とともに解釈します。

* 尤度比検定のP値
  * 尤度比検定のP値は、モデル全体の統計的有意性を示します。
  * 一般的に5%（0.05）未満であれば、統計的に有意であると判断されます。
  * 値は0から1の間で、P値が小さいほど統計的有意性が高いことを示します。

* スコア検定
  * スコア検定もモデルの全体的な有意性を評価する別の統計的手法です。
  * 値が大きいほど、モデルが統計的に意味があることを示します。
  * 計算が比較的簡単なため、初期モデル評価によく使用されます。

* スコア検定のP値
  * スコア検定のP値は、このテストの統計的有意性を示します。
  * 一般的に5%（0.05）未満であれば、統計的に有意であると判断されます。
  * 値は0から1の間で、P値が小さいほど統計的有意性が高いことを示します。

* ワルド検定
  * ワルド検定は各係数の有意性を個別に評価する統計量です。
  * 値が大きいほど、その係数が統計的に意味があることを示します。
  * モデル全体よりも個々の変数の有意性評価に適しています。

* ワルド検定のP値
  * ワルド検定のP値は、この検定の統計的有意性を示します。
  * 一般的に5%（0.05）未満であれば、統計的に有意であると判断されます。
  * 値は0から1の間で、P値が小さいほど統計的有意性が高いことを示します。

* R2乗
  * コックス回帰におけるR2乗は、モデルによって説明されるリスクの変動割合を示します。
  * 通常の回帰分析のR2乗とは異なり、解釈には注意が必要です。
  * 値は0から1の間で、大きいほどモデルの説明力が高いことを示します。

* R2乗 (最大値)
  * R2乗の理論上の最大値を示し、データの特性から達成可能な最大の説明力を表します。
  * 実際のR2乗をこの値と比較することで、モデルの相対的な性能を評価できます。
  * 低い最大値は、データの打ち切り（センサリング）が多いことを示唆します。

* 対数尤度
  * 対数尤度はモデルのデータへの適合度を数値化したものです。
  * 通常は負の値を取り、0に近いほどモデルの適合度が高いことを示します。
  * モデル比較のためのAICやBICの計算に使用されます。

* AIC
  * AIC（赤池情報量基準）はモデルの複雑さと適合度のバランスを評価する指標です。
  * 値が小さいほど優れたモデルとされ、過学習を防ぎながら最適なモデルを選択するのに役立ちます。
  * 同じデータセットで異なるモデルを比較する際に使用されます。

* BIC
  * BIC（ベイズ情報量基準）はAICと同様にモデル選択のための指標ですが、サンプルサイズによる補正がより厳しくなっています。
  * AICよりも単純なモデルを選ぶ傾向があり、値が小さいほど良いモデルと判断されます。
  * 大きなサンプルサイズでの分析や、真のモデルが比較的単純だと考えられる場合に有用です。

* VIF (最大値)
  * VIF（分散拡大要因）は予測変数間の多重共線性の程度を示す指標です。
  * 一般的にVIFが10以上の変数は多重共線性の問題があると判断されます。
  * 値は1以上で、1に近いほど多重共線性が少ないことを示します。

* 行数
  * 行数は分析に使用したデータの総数（サンプルサイズ）です。
  * データ数が多いほど、統計的検定の検出力が高まり、結果の信頼性が向上します。
  * 生存時間分析では、イベント発生数（TRUE）と打ち切り数の両方が重要です。

* 行数 (TRUE)
  * イベントが発生したデータの行数を示します。
  * コックス回帰では、イベント発生数が少ない場合、推定の精度が低下する可能性があります。
  * 一般的に、予測変数1つあたり少なくとも10〜20のイベント発生が推奨されます。
{end_show_hide}

**モデルの予測能力**

<% if (concordance > 0.8) { %>
  一致係数は<%= concordance %>と高く、このモデルは生存時間の順序を正確に予測できることを示しています。これは、ランダムに選んだ2つのケースにおいて、モデルが生存時間の長短を正しく順序付ける確率が約<%= 100 * concordance %>%であることを意味します。
<% } else if (concordance > 0.7) { %>
  一致係数は<%= concordance %>と中程度で、このモデルは生存時間の順序をある程度予測できることを示しています。これは、ランダムに選んだ2つのケースにおいて、モデルが生存時間の長短を正しく順序付ける確率が約<%= 100 * concordance %>%であることを意味します。
<% } else { %>
  一致係数は<%= concordance %>とやや低く、このモデルによる生存時間の順序予測は限定的です。これは、ランダムに選んだ2つのケースにおいて、モデルが生存時間の長短を正しく順序付ける確率が約<%= 100 * concordance %>%であることを意味します。
<% } %>

**モデルの有意性**

<% if (likelihood_ratio_test_p < 0.05) { %>
  尤度比検定のP値は<%= 100 * likelihood_ratio_test_p %>% (<%= likelihood_ratio_test_p %>)で、有意水準5% (0.05) より低いため、モデル全体は統計的に有意だと言えます。これは、選択された予測変数が生存時間の予測に貢献していることを示しています。
<% } else { %>
  尤度比検定のP値は<%= 100 * likelihood_ratio_test_p %>% (<%= likelihood_ratio_test_p %>)で、有意水準5% (0.05) より高いため、モデル全体は統計的に有意とは言えません。これは、選択された予測変数が生存時間の予測にあまり貢献していない可能性を示唆しています。
<% } %>

## 選択された予測変数と生存時間の関係の強さ

選択された予測変数と生存時間の関係の強さを相対的に表したのが以下のチャートです。

{{variable_importance}}

## それぞれの予測変数と生存時間の関係

それぞれの予測変数の値が変わると、ハザード比（リスク比）がどのように変わるかを表したのが以下のチャートです。変数は生存時間との関係が最も強いものから弱い方への順番で並んでいます。

{{variable_effect}}

## 変数ごとの係数と有意性

それぞれの予測変数の有意性、またそれらの値が変わるとハザード比（イベント発生リスク）がどれほど変わるのかを表したのが以下のチャートです。

{{coefficient}}

それぞれのエラーバーの真ん中の点はハザード比の値、上下の線はその95%信頼区間を表しています。生存時間との関係が有意で、かつその関係が正（ハザード比 > 1）の予測変数は赤、関係が負（ハザード比 < 1）の予測変数は青となっています。グレーで表されている予測変数は生存時間との関係が有意とは言えません。有意性の判断はP値または信頼区間によって行うことができます。どちらで判断しても同じ結果となります。

### P値

有意水準が5%の元では、P値が5%よりも大きい予測変数は生存時間との関係が統計的に有意だとは言えません。逆に、P値が5%よりも小さい予測変数は生存時間との関係が統計的に有意だと言えます。

_現在の有意水準（P値）は5% (0.05)に設定されていますが、これはアナリティクスの「設定」より変更可能です。_

### 信頼区間

ハザード比の95%信頼区間は、「真のハザード比の値がこの範囲内にある可能性が95%ある」ということを意味します。
ハザード比が1であるということは、予測変数の値が変化してもイベント発生リスクが変わらないため、生存時間との関係がないことを表します。
そのため、95%信頼区間が1を含んでいる予測変数は、生存時間との関係が全くない可能性があるため、統計的に有意だと言えません。逆に、95%信頼区間が1を含んでいない予測変数は、生存時間との関係が全くない可能性はほぼないため、統計的に有意だと言えます。

それぞれの予測変数の係数（ハザード比）はそのデータ型によって以下のように解釈できます。

**数値型の場合：**

他の変数の値が一定だとしても、予測変数が1単位上がると、イベント発生のハザード（瞬間的な発生率）は約X倍になります。

**ロジカル型の場合：**

他の変数の値が一定だとしても、予測変数がTRUEの場合、FALSEに比べイベント発生のハザードは約X倍になります。

**カテゴリー（文字列）型の場合：**

他の変数の値が一定だとしても、予測変数の値が、ベースレベルである"Y"と比べてイベント発生のハザードが約X倍になります。

### 注意点

* ハザード比が1より大きい場合は、その変数が増加するとイベント発生リスクが高まります（生存時間が短くなる）。
* ハザード比が1より小さい場合は、その変数が増加するとイベント発生リスクが低下します（生存時間が長くなる）。
* これらの係数の値は、あくまでもそれぞれの予測変数の値が1単位変わった場合の変化量であり、予測変数同士で単位が異なる場合にはそれらの係数の値を使って生存時間との関係の強さを比べることはできません。予測変数間の関係の強さを比べたい場合は、上記の「選択された予測変数と生存時間の関係の強さ」を参照ください。

上記のチャートの元となるデータが以下の表となります。

{{coefficient_table}}

## 生存曲線

モデルに基づいた代表的な生存曲線を表したのが以下のグラフです。この曲線は、時間の経過に伴うイベント非発生確率（生存確率）の推定値を示しています。

{{survival_curve}}

# 次のステップ

* 変数選択の最適化：統計的に有意でない変数（P値が5%以上の変数）を除外して、モデルをシンプルにすることを検討してください。これにより、モデルの解釈がしやすくなり、過剰適合のリスクも減少します。
* 比例ハザード仮定の検証：コックス回帰の重要な前提条件である「比例ハザード仮定」（ハザード比が時間によって変化しないという仮定）を検証してください。この仮定が満たされていない場合、層別分析や時間依存変数の導入を検討する必要があります。
* 交互作用の検討：異なる予測変数間に交互作用がある可能性を検討してください。特に、理論的または実務的に関連がありそうな変数間の交互作用を調べることで、より精緻な分析ができるかもしれません。
* グループ別分析：データを重要な特性（例：性別、年齢層、疾患グループなど）で層別化し、それぞれのサブグループで別々のモデルを構築することで、グループ特有のリスク要因を特定できるかもしれません。
* モデルの予測精度の検証：時間依存的ROC曲線分析やブライアスコアなど、生存時間モデルの検証手法を用いて、モデルの予測性能をより詳細に評価することを検討してください。


# 補足情報

## トレーニングデータに対する予測

元のデータに対して、作成された予測モデルを使って予測した結果が以下の表となります。

{{data}}

