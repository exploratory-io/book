const template =
`# サマリ

以下の変数を元に因子分析を行い、変数間の相関関係から潜在的な共通因子を特定しました。

<% variables.forEach(variable => { %>
  - <%= variable.name %>
<% }); %>

分析の結果、<%= factor_count %>個の因子が抽出されました。これら<%= factor_count %>個の因子でデータ全体のばらつきの<%= cumulative_variance %>%を説明できます。

## 有意性

ここでの有意性に関する情報は、この分析の目的が「仮定した因子構造がデータと適合するかを検証」する場合にのみ有用となる情報です。もし、分析の目的がデータから「因子構造を発見」することであれば、ここでの情報は現実的にはあまり意味がないため、「因子と変数の関係」に進んでください。

<% if (p > baseline_p) { %>
仮説検定としてカイ2乗検定が行われています。帰無仮説は「因子モデル（構造）とデータは適合する」です。P値は<%= p_value %>で有意水準を<% 100 * baseline_p %>%とした場合、それよりも大きいため、帰無仮説を棄却できないため、この因子モデルはデータと適合していると判断できます。
<% } else { %>
仮説検定としてカイ2乗検定が行われています。帰無仮説は「因子モデル（構造）とデータは適合する」です。P値は<%= p_value %>で有意水準を<% 100 * baseline_p %>%とした場合、それよりも小さいため、帰無仮説を棄却できるため、この因子モデルはデータと適合していないと判断できます。
<% } %>

# 因子と変数の関係

以下の表は、各変数に対する各因子の因子負荷量を示しています。

{{factor_loadings_table}}

* 因子負荷量は、各変数と各因子の相関係数を表し、その値は-1から1の間で、1に近いほど強い正の相関、-1に近いほど強い負の相関、0に近いほど相関がないことを示します。一般的に0.4以上または-0.4以下の場合、その変数と因子には意味のある関係があると解釈できます。
* 各変数のばらつきのうち、今回抽出された<%= factor_count %>個の因子によって説明される割合が「共通性」の列として、説明できない割合（）が「独自性」の列として示されています。

**因子負荷量（レーダー）**

各変数の因子負荷量を因子ごとに可視化したのが以下のレーダーチャートです。

{{factor_loadings_radar}}

各軸はそれぞれの変数を表し、数値は因子負荷量の絶対値となります。それぞれの因子の線がある変数のところで外側に伸びていれば、それはその変数と関連が強いと解釈できます。

# 変数間の関係

第1因子と第2因子で表した平面上に全ての変数間の関係を可視化したのが以下の「バイプロット」と呼ばれるチャートです。

{{biplot}}

元のデータのばらつきは<%= number_of_variables %>個の変数によって表されるものですが、それを<%= factor_count %>個因子のうちの最初の2つの因子をX軸、Y軸にした２次元（X軸とY軸）空間で、できる限り元のデータの持つ情報量（ばらつき）を失わないように可視化しようとしたものです。

それぞれの変数は中心点（0, 0）から外側に向かって伸びるグレーの線によって表されています。線が同じ方向に向かっている変数どうしは相関が強いと言えます。

# 因子数

因子の適切な数を決めるために、以下のスクリープロットを使うことができます。

{{scree_plot}}

X軸は因子の数を増やしていった時の因子の数、Y軸はそれぞれの因子がせつめいできるばらつきの大きさである固有値を示します。固有値1は1つの変数のばらつき（分散）と想定することができます。もし第1因子の固有値が2.7であれば、これは変数約2.7個分のばらつきを説明していると解釈できます。

そのため、一般的に固有値が1以上となる因子までの数が最適な因子数だと推奨されます（カイザーの基準）。3番目の因子の固有値が1以上、4番目の因子の固有値が1未満となっている場合、最適な因子数は3となります。また、スクリープロットの「肘」の位置（曲線の傾きが大きく変わる点）も、適切な因子数を判断する目安として推奨されます。


<% if (has_category) { %>

# 因子とカテゴリーの関係

カテゴリーとして選択された'<%= category %>'と因子の関係をレーダーチャートを使って可視化したものが以下です。

{{category_factor_relationship}}

このチャートは、各カテゴリーごとにそれぞれの因子における因子得点の平均値を可視化しています。これにより、特定のカテゴリーがどの因子と強く関連しているかを把握できます。

<% } %>

# データ

因子得点（各観測値がそれぞれの因子においてどの程度の値を持つか）を計算し、元のデータに追加したものが以下の表です。

{{data}}


# 補足情報

## 寄与率

各因子がデータ全体のばらつき（因子負荷量平方和）をどの程度説明しているかを示す値が寄与率です。

{start_lazy_show_hide}
### チャート
{{variance_explained}}
{end_lazy_show_hide}

<% for (let i = 0; i < factor_count; i++) { %>
* 第<%= i+1 %>因子: <%= factors[i] %>%
<% } %>

## 因子負荷量に関するチャート

**因子負荷量（バー）**

各変数のそれぞれの因子に対する因子負荷量をバーチャートで表示しています。バーの長さは因子負荷量の大きさを表し、正の値は右方向、負の値は左方向に伸びています。

{start_lazy_show_hide}
### チャート
{{factor_loadings_bars}}
{end_lazy_show_hide}

**因子負荷量（パス）**

以下のパス図は各因子と変数の関連を可視化したもので、線の太さは因子負荷量の絶対値に比例しており、太いほど関連が強いことを示しています。色は各因子を区別するためのものです。

{start_lazy_show_hide}
### チャート
{{factor_path}}
{end_lazy_show_hide}
`;

module.exports = template;
