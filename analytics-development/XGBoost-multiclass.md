const template =
`# <%= model %>を使った<%= target %>と選択された予測変数の関係の分析

目的変数である<%= target %>と選択された予測変数との関係を調べるためにXGBoostを使った予測モデルが作られました。

# サマリ

## 予測精度

{{summary}}

{start_show_hide}
## 主要な統計指標
* F値 (マイクロ平均)
  * F値（マイクロ平均）は全てのクラスを統合して計算されたF値で、全体的な分類性能を示します。
  * 値は0から1の間で、1に近いほど全体的な予測精度が高いことを意味します。
  * 分類ごとのサンプル数の影響を受けやすく、多数派クラスの性能が強く反映されます。

* F値 (マクロ平均)
  * F値（マクロ平均）は分類ごとのF値を単純平均したもので、クラス間のバランスを考慮した分類性能を示します。
  * 値は0から1の間で、1に近いほどすべてのクラスで均等に高い予測精度を保っていることを意味します。
  * サンプル数の偏りに影響されにくく、少数派クラスの性能も平等に評価されます。

* 正解率
  * 正解率（Accuracy）は全予測中の正しい予測の割合を示します。
  * 値は0から1の間で、1に近いほど多くの事例を正しく分類できることを意味します。
  * クラス間にサンプル数の大きな偏りがある場合は、誤解を招く可能性があります。

* 誤分類率
  * 誤分類率（Error Rate）は全予測中の誤った予測の割合で、1-正解率で計算されます。
  * 値は0から1の間で、0に近いほど誤分類が少ないことを意味します。
  * 正解率と同様に、クラス間のサンプル数に大きな偏りがある場合は解釈に注意が必要です。

* 行数
  * 行数は分析に使用したデータの総数（サンプルサイズ）を示します。
  * データ数が多いほど、モデルの信頼性が高まりますが、計算コストも増加します。
  * 多クラス分類では、分類ごとに十分なサンプル数があることが重要です。
{end_show_hide}

**モデルの性能指標**

* 正解率: 全体の約<%= accuracy_pct %>%のケースで<%= target %>を正しく予測できています。
* F値（マイクロ平均）: 全体的な分類性能を示すF値（マイクロ平均）は<%= f1_micro %>となっています。
* F値（マクロ平均）: 分類ごとのバランスを考慮したF値（マクロ平均）は<%= f1_macro %>となっています。
* 誤分類率: 全体の約<%= error_rate_pct %>%のケースで誤分類が発生しています。

## 分類ごとの予測精度

分類ごとの予測精度を示したのが以下の表です。

{{class_summary}}

* F1スコア
  * F1スコアは分類ごとの適合率と再現率の調和平均で、そのクラスに対する分類性能の総合指標です。
  * 値は0から1の間で、1に近いほどそのクラスの予測精度が高いことを意味します。
  * クラス不均衡がある場合でも、分類ごとの性能を適切に評価できます。

* 正解率
  * 分類ごとの正解率は、そのクラスと予測されたもののうち実際にそのクラスだった割合を示します。
  * 値は0から1の間で、1に近いほどそのクラスの予測が正確であることを意味します。
  * 全体の正解率とは異なり、クラス単位での予測精度を表します。

* 誤分類率
  * 分類ごとの誤分類率は、そのクラスと予測されたもののうち実際には違うクラスだった割合を示します。
  * 値は0から1の間で、0に近いほどそのクラスの誤分類が少ないことを意味します。
  * 1-正解率で計算され、クラス単位での予測エラー率を表します。

* 適合率
  * 適合率は「そのクラスと予測したもののうち、実際にそのクラスだった割合」を示します。
  * 値は0から1の間で、1に近いほど「そのクラスと予測したものが実際にそのクラスである精度」が高いことを意味します。
  * 偽陽性（実際は違うクラスなのにそのクラスと予測）を最小化したい場合に重視される指標です。

* 再現率
  * 再現率は「実際にそのクラスであるもののうち、そのクラスと正しく予測できた割合」を示します。
  * 値は0から1の間で、1に近いほど「実際のそのクラスのケースを見逃さない能力」が高いことを意味します。
  * 偽陰性（実際はそのクラスなのに違うクラスと予測）を最小化したい場合に重視される指標です。

* 行数
  * 分類ごとのデータの行数を示します。
  * クラス間でサンプル数に大きな偏りがある場合、モデルの学習や評価に影響を与える可能性があります。
  * 少数派クラスの性能が低い場合、サンプル数不足が原因の可能性があります。

## 選択された予測変数と<%= target %>の関係の強さ

選択された予測変数と<%= target %>の関係の強さを相対的に表したのが以下のチャートです。

{{variable_importance}}

## それぞれの予測変数と<%= target %>の関係

それぞれの予測変数の値が変わると、<%= target %>の確率がどのように変わるかを表したのが以下のチャートです。変数は<%= target %>との関係が最も強いものから弱い方への順番で並んでいます。

{{variable_effect_logical}}

# 次のステップ

* 変数選択の最適化：変数重要度が低い予測変数を除外して、モデルをシンプルにすることを検討してください。これにより、モデルの解釈がしやすくなり、過剰適合のリスクも減少します。
* グループ別分析：グループごとに別々のモデルを作成することで、それぞれのグループ内での<%= target %>の決定要因をより詳細に理解できるかもしれません。その場合は、「繰り返し」にグループとなる変数を選択し、実行し直すことができます。
* 外れ値の確認：予測精度に影響を与える可能性のある外れ値がないか確認し、必要に応じて対処することで、モデルの信頼性が向上する可能性があります。
* モデルの評価：このモデルの予測性能をより厳密に評価するために、トレーニングデータとテストデータに分けて検証することを検討してください。
* TRUE/FALSEの境界値の調整：予測のTRUE/FALSEの境界値を調整することで、適合率と再現率のバランスを変えることができます。TRUE/FALSEの境界値を変更したい場合は、設定から変更が可能です。
* パラメータの調整：XGBoostのパラメータ（木の深さ、学習率、学習回数など）を調整することで、モデルの性能をさらに向上させることができるかもしれません。

# 補足情報

## トレーニングデータに対する予測

元のデータに対して、作成された予測モデルを使って予測した結果が以下の表となります。

{start_lazy_show_hide}
### チャート
{{data}}
{end_lazy_show_hide}

## 予測マトリックス

この表は、モデルの予測結果と実際の結果の対応関係を示す予測マトリックスです。各セルの値は全体に対する割合（%）を表しています。

{start_lazy_show_hide}
### チャート
{{confusion_matrix}}
{end_lazy_show_hide}

## 予測確率分布

このチャートは、モデルが予測した<%= target %>の確率（0～1の間の値）を実際にTRUEのケース（青線）、実際にFALSEのケース（オレンジの線）に分けて密度曲線として可視化しています。
理想的には、実際にTRUEのケース（青線）は右側（1に近い確率）に、実際にFALSEのケース（オレンジ線）は左側（0に近い確率）に集中しているほど、モデルの予測精度が高いと言えます。縦の点線は、TRUEとFALSEを分類するために使用されているTRUE/FALSEの境界値を示しています。この分布からモデルの分類性能や、最適なTRUE/FALSEの境界値の調整を視覚的に確認できます。

{start_lazy_show_hide}
### チャート
{{probability_distribution}}
{end_lazy_show_hide}

## ROC曲線

この曲線は、モデルの分類性能を様々な閾値で評価するROC曲線です。Y軸は真陽性率（感度）、X軸は偽陽性率（1-特異度）を表しています。青い線は今回のモデルのROC曲線で、対角線の灰色の点線はランダムな予測（AUC: 0.5）を意味します。曲線が左上に膨らむほど予測精度が高く、対角線に近いほど予測精度が低いことを示します。

{start_lazy_show_hide}
### チャート
{{roc_curve}}
{end_lazy_show_hide}

## 学習回数と精度の向上

モデルの学習過程を表したのが以下のチャートです。横軸は学習回数、縦軸はRMSE（予測誤差）を表しています。
XGBoostは学習回数が増えるごとにRMSEが減少していき初期の学習ではRMSEが急速に減少し、その後は緩やかになっていく傾向があります。
学習曲線が平坦化してきた場合は、最適な学習回数に近づいている可能性があります。逆に、まだ誤差が減少し続けている場合は、さらに学習回数を増やすことで性能向上が見込める可能性があります。

{start_lazy_show_hide}
### チャート
{{learning_curve_logical}}
{end_lazy_show_hide}
`;

module.exports = template;
