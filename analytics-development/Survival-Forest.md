const template = `
<br/>
<!-- intentional new line feed above -->

選択された説明変数を元に、<%= event_status %>の生存曲線を予測するサバイバル・フォレストモデルを作成しました。

# モデルの指標

<% if (!test_mode) { %>
モデルの予測精度に関する指標を以下の表にまとめています。
<% } else { %>
モデルの予測精度に関する指標を、以下の表にまとめています。現在テストモードであるため、トレーニングデータとテストデータ両方に対しての指標を表示しています。
<% } %>

{{summary_chart}}

## 予測精度

* 一致係数
  * 一致係数はモデルの予測能力を示す指標で、ランダムに選んだ2つの観察対象（行）のうち、モデルが実際の生存時間の順序を正しく予測できる確率を表します。
  * 値は0.5から1の間で、0.5はランダム予測と同等、1は完璧な予測を意味します。
  * 一般的に0.7以上で許容可能、0.8以上で良好な予測性能と解釈されます。

* 時点AUC
  * 時点AUCは特定の時点において、このモデルがTRUEのデータとFALSEのデータをうまく分類することができるかを測る指標です。
  * 現在、予測期間は<%= survival_period%>となっているため、<%= survival_period%>経過時点での生存率の予測値が時点AUCの計算に使われています。期間は[「設定」](//analytics/settings)より変更可能です。
  * 値は0.5から1の間で、0.5はランダムな予測（コイン投げと同等）、1はTRUEとFALSEのデータを完全に分類できることを意味します。
  * 一般的に0.6以上で許容範囲、0.8以上で良好、0.9以上で非常に優れた分類性能と解釈されます。
  * 複数の時点でのAUCを確認することで、モデルの予測性能の時間的安定性を評価できます。



# 変数間の関係

<% if (predictorColumns.length > 1) { %>
## 説明変数の重要度

<%= event_status %>に関する生存曲線を予測するために、どの説明変数が相対的により重要なのかを表したのが以下のチャートです。

{{variable_importance}}

<% } %>

## 説明変数の影響度

期間が<%= survival_period%>の時点において、それぞれの説明変数の値が変わると<%= event_status %>の発生確率がどのように変わるかを表したのが以下のチャートです。期間は[「設定」](//analytics/settings)より変更可能です。

{{variable_effect}}

* 青い線（または点）は期間が<%= survival_period%>の時点において、他の変数の値が一定であったときの予測値を示します。
* グレーの線は実測値とその95%信頼区間を示します。

注意点：

<% if (predictorColumns.length > 1) { %>

* 他の変数が一定だとした時に、その説明変数単体の効果を予測しているため、実測値の平均値と予測値にずれが生じます。
* 予測値の計算方法の詳細は、[こちらのノート](https://exploratory.io/note/exploratory/Sbd0LDU6)をご参照ください。
* 説明変数は上記の「説明変数の重要度」にある重要度の高い順番で並んでいます。

<% } %>
* カテゴリー型（Character型、Factor型）の説明変数において一意の値が12個より多い場合は、頻度の多いものから11個の値を残し、それ以外は「その他」としています。これは[「設定」](//analytics/settings)より変更可能です。

# 生存曲線

モデルに基づいた説明変数ごとの生存曲線を表したのが以下のチャートです。この曲線は、時間の経過に伴う生存確率（イベントの非発生確率）の予測値を示しています。

{{survival_curve}}

# 補足情報

<% if (!test_mode) { %>
## トレーニングデータに対する予測

トレーニングデータに対して、作成された予測モデルを使って予測した結果が以下の表となります。
<% } else { %>
## トレーニング・テストデータに対する予測

トレーニングデータとテストデータに対して、作成された予測モデルを使って予測した結果が以下の表となります。
<% } %>

{start_lazy_show_hide}
### 予測結果
{{data}}
{end_lazy_show_hide}


## ROC曲線

<% if (!test_mode) { %>
モデルの分類性能を様々なTRUE/FALSEの境界値で評価するROC曲線が以下のチャートです。Y軸は真陽性率（感度）、X軸は偽陽性率（1-特異度）を表しています。青い線は今回のモデルのROC曲線で、対角線の灰色の点線はランダムな予測（AUC: 0.5）を意味します。ROC曲線は左上に膨らむほど予測精度が高く、対角線に近いほど予測精度が低いことを示します。
<% } else { %>
モデルの分類性能を様々なTRUE/FALSEの境界値で評価するROC曲線が以下のチャートです。Y軸は真陽性率（感度）、X軸は偽陽性率（1-特異度）を表しています。青い線は今回のモデルのテストデータに対するROC曲線、オレンジの線はトレーニングデータに対するROC曲線です。対角線の灰色の点線はランダムな予測（AUC: 0.5）を意味します。ROC曲線は左上に膨らむほど予測精度が高く、対角線に近いほど予測精度が低いことを示します。
<% } %>

{{roc_curve}}

ROC曲線の計算には、<%= survival_period%>経過時点での生存率の予測値が使われています。期間は[「設定」](//analytics/settings)より変更可能です。


## 次のステップ

* 変数選択の最適化：変数重要度が低い予測変数を除外して、モデルをシンプルにすることを検討してください。これにより、モデルの解釈がしやすくなり、過剰適合のリスクも減少します。
<% if (!repeat_by) { %>
* グループ別分析：グループごとに別々のモデルを作成することで、それぞれのグループ内での生存曲線の決定要因をより詳細に理解できるかもしれません。その場合は、「繰り返し」にグループとなる変数を選択し、実行し直すことができます。
<% } %>
* 外れ値の確認：予測精度に影響を与える可能性のある外れ値がないか確認し、必要に応じて対処することで、モデルの信頼性が向上する可能性があります。
<% if (!test_mode) { %>
* モデルの評価：このモデルの予測性能をより厳密に評価するために、トレーニングデータとテストデータに分けて検証することができます。その場合は、[「設定」](//analytics/settings)より「検証」セクションの下の「テストモード」をTRUEに設定し、実行し直してください。
<% } %>
* 新しいデータに対する予測：作成したモデルを使って新しいデータに対して予測をしたいときには、予測をしたい対象のデータフレームに「モデルで予測（アナリティクス・ビュー）」のステップを追加します。詳細は、[こちらのノート](https://exploratory.io/note/exploratory/qIr9Hfa5)をご参照ください。

`;

module.exports = template;
