const template = `
<br/>
<!-- intentional new line feed above -->

<% if (!test_mode) { %>
<%= target %> を予測するモデルが作られました。<%= period %><%= unit %>後までを予測していますが、こちらの予測期間は[「設定」](//analytics/settings)の「予測期間」より変更できます。
<% } else { %>
<%= target %> を予測するモデルが作られました。現在テストモードであるため、データの最後から<%= test_period %><%= unit %>前までのデータを使ってモデルを作り、それ以降の期間（テスト期間）に対して予測しています。テスト期間はアナリティクスの[「設定」](//analytics/settings)の「テストデータの期間」のセクションより変更できます。
<% } %>

# 予測結果

<% if (!test_mode) { %>
実測値（青線）とモデルによって予測された値（オレンジ線）をラインチャートを使って可視化したのが以下です。
<% } else { %>
トレーニングデータ（青線）のモデルによって予測された値（オレンジ線）をラインチャートを使って可視化したのが以下です。現在テストモードであるため、テストデータの期間は水色のラインで可視化しています。
<% } %>

{{forecast_chart}}

# 時系列要素の分析

## 時系列データの季節性

データに含まれる季節的なパターンを以下のグラフに示します。これは、一定の周期で繰り返される変動を表しています。

{{seasonality}}

## 時系列データのトレンド

以下のチャートは<%= target %>の長期的なトレンド（傾向）を可視化したものです。このグラフには以下の要素が含まれています：

- 青い線は<%= target %>の実測値の推移が確認できます。
- 緑の線は実測値から季節性や不規則な変動を取り除いたトレンドを表しています。これにより<%= target %>のトレンドがどういった傾きなのかを理解することができます。トレンドの変化点によってこのトレンドの傾きが変わるようになっています。
- 赤いバーはトレンドの変化点で、<%= target %>の動きが大きく変わった時点を表しています。

{{trend_chart}}

## 時系列データの定常性

以下のチャートはKPSS検定による残差分析の結果を示します。平均値の0を中心としてどれだけばらついているのかを確認できます。

{{stationarity}}

定常なデータとは、時間によらず以下の特性が一定に保たれるデータのことを表し、ARIMA/SARIMAのモデルを適切に適用するための重要な前提条件となります。

* 平均値が一定（トレンドがない）
* 分散が一定（データのばらつき方が時期によって変わらない）
* 自己相関が時間差のみに依存（季節性などの周期的パターンがない）

## 自己相関

以下のチャートは時系列データの自己相関関数（ACF）を確認することができます。

{{autocorrelation}}

自己相関とは、時系列データにおいて、現在の値と過去の値との関係の強さを示すものです。

グラフの横軸（X軸）は「ラグ」と呼ばれ、何日前のデータとの関係を見ているかを表します。縦軸（Y軸）は相関係数で、-1から1の間の値をとり、0に近いほど関係が弱く、±1に近いほど関係が強いことを示します。

## 偏自己相関

以下のチャートは時系列データの偏自己相関関数（PACF）を確認することができます。

{{partial_autocorrelation}}

偏自己相関とは、時系列データにおいて、間にある値の影響を除外した上で、現在の値と過去の値との直接的な関係の強さを示すものです。

グラフの横軸（X軸）は「ラグ」で、何日前のデータとの関係を見ているかを表します。縦軸（Y軸）は相関係数で、-1から1の間の値をとり、0に近いほど関係が弱く、±1に近いほど関係が強いことを示します。


# 予測精度

<% if (!test_mode) { %>
トレーニングデータに対するモデルの予測精度に関する様々な指標を以下の表にまとめています。
<% } else { %>
現在テストモードであるため、テストデータに対するモデルの予測精度に関する様々な指標を以下の表にまとめています。
<% } %>

{{summary}}

<% if (!repeat_by) { %>

主な評価指標は以下の通りです。

* RMSE（ルート平均2乗誤差）: 予測値と実測値の差は平均して<%= rmse %>ほどです。値が小さいほど予測精度が高いことを示します。
* MAE（平均絶対誤差）:  予測値と実測値の差（絶対値）は平均して<%= mae %>ほどです。値が小さいほど予測精度が高いことを示します。
* MAPE（平均絶対誤差率）: 予測値と実測値の差（絶対値）は実測値に対して<%= mape * 100 %>%ほどです。値が小さいほど予測精度が高いことを示します。
* R2乗値: このモデルは<%= target %>のばらつきの<%= r_squared * 100 %>%を説明できています。

<% } %>


## モデルの診断

<% if (ljung_box_p > baseline_p) { %>
 リュング・ボックス検定のP値は<%= ljung_box_p %>で<%= baseline_p %>を上回っており、モデルの残差に有意な自己相関は見られません。これはモデルが時系列の構造を適切に捉えていることを示唆しています。
<% } else { %>
 リュング・ボックス検定のP値は<%= ljung_box_p %>で<%= baseline_p %>を下回っており、モデルの残差にはまだ自己相関が残っている可能性があります。モデルのパラメータの調整や、別のモデル構造の検討が必要かもしれません。
<% } %>

{start_show_hide}
## モデルの指標の詳細
* RMSE
 * RMSE（Root Mean Square Error：平均二乗誤差の平方根）は予測値と実測値の誤差の大きさを測定します。
 * 目的変数と同じ単位で表されるため解釈しやすく、値が小さいほど予測精度が高いことを意味します。
 * 0以上の値を取り、完璧な予測であれば0になります。

* MAE
 * MAE（Mean Absolute Error：平均絶対誤差）は予測値と実測値の絶対誤差の平均を表します。
 * 目的変数と同じ単位で表され、値が小さいほど予測精度が高いことを示します。
 * RMSEと比べて外れ値の影響を受けにくい特性があります。

* MAPE (比率)
 * MAPE（Mean Absolute Percentage Error：平均絶対パーセント誤差）は予測の相対的な誤差をパーセンテージで表します。
 * 値が小さいほど予測精度が高く、一般的に10%未満であれば良好な予測と考えられます。
 * 実測値が0または非常に小さい場合、値が極端に大きくなる可能性があるため注意が必要です。

* R2乗
 * R2乗（決定係数）はモデルの説明力を示し、データの変動のうちモデルで説明できる割合を表します。
 * 値は通常0から1の間で、1に近いほどモデルの適合度が高いことを示します。
 * 時系列モデルでは、傾向があるデータで人為的に高くなることがあるため、解釈に注意が必要です。

* AIC
 * AIC（赤池情報量基準）はモデルの複雑さと適合度のバランスを評価する指標です。
 * 値が小さいほど優れたモデルとされ、過学習を防ぎながら最適なモデルを選択するのに役立ちます。
 * 異なるARIMA/SARIMAモデルを比較する際に特に有用です。

* BIC
 * BIC（ベイズ情報量基準）はAICと同様にモデル選択のための指標ですが、パラメータ数によるペナルティがより厳しいです。
 * AICよりも単純なモデルを選ぶ傾向があり、値が小さいほど良いモデルと判断されます。
 * 大きなサンプルサイズでの分析や、真のモデルが比較的単純だと考えられる場合に有用です。

* AICc
 * AICc（修正AIC）は小サンプルサイズでの偏りを修正したAICの変種です。
 * サンプルサイズが小さい場合でも信頼性の高いモデル選択が可能です。
 * サンプルサイズが大きくなるにつれてAICに近づきます。

* p, d, q
 * ARIMAモデルのパラメータで、p（自己回帰項の次数）、d（差分の次数）、q（移動平均項の次数）を表します。
 * pは過去の値がどれだけ現在の値に影響するか、qは過去の予測誤差がどれだけ影響するかを示します。
 * dはデータを定常化するために必要な差分の回数を示します。

* P, D, Q
 * SARIMAモデルの季節成分のパラメータで、P（季節自己回帰項の次数）、D（季節差分の次数）、Q（季節移動平均項の次数）を表します。
 * これらはpとq、dと同様の意味を持ちますが、季節周期ごとの関係を捉えます。

* 周期
 * 季節成分の周期を表し、例えば月次データなら12、四半期データなら4、週次データなら7などの値を取ります。
 * SARIMAモデルで季節性を考慮する際に重要なパラメータです。

* リュング・ボックス統計量
 * モデルの残差（予測誤差）に自己相関がないかをテストする統計量です。
 * 値が大きいほど、残差に自己相関が残っている可能性が高いことを示します。

* リュング・ボックス検定のP値
 * リュング・ボックス統計量に基づくP値で、通常0.05以上であれば残差に有意な自己相関がないと判断されます。
 * P値が小さい場合、モデルが時系列の構造を十分に捉えきれていない可能性があります。

* 行の数
 * 分析に使用したデータの総数（サンプルサイズ）を示します。
 * 時系列モデルでは、十分なデータ量があることが精度の高い予測には重要です。
{end_show_hide}


## 予測データ

<% if (!test_mode) { %>
予測結果を元のデータに加えたものが以下の表となります。
<% } else { %>
元のデータをトレーニングデータとテストデータに分けて予測した結果を加えたのが以下の表となります。
<% } %>

{start_lazy_show_hide}
### データ
{{data}}
{end_lazy_show_hide}

# 補足情報

## 残差分析

以下は予測モデルの残差（予測値と実測値の誤差）をラインチャートで可視化したものです。良いモデルでは、残差はランダムで、安定した分散を持つことが期待されます。

{start_lazy_show_hide}
### チャート
{{residuals}}
{end_lazy_show_hide}

## 残差の自己相関

以下はモデルの残差の自己相関関数（ACF）をバーチャートで可視化したものです。

{start_lazy_show_hide}
### チャート
{{residual_autocorrelation}}
{end_lazy_show_hide}

## 残差の偏自己相関

以下はモデルの残差の偏自己相関関数（PACF）をバーチャートで可視化したものです。

{start_lazy_show_hide}
### チャート
{{residual_partial_autocorrelation}}
{end_lazy_show_hide}

# 次のステップ

* 予測期間の最適化: より短期の予測に焦点を当てることで、予測精度を向上させることができる可能性があります
* 他のモデルとの比較: 異なるパラメータ設定のARIMA/SARIMAモデルや、Prophetなどの他の時系列モデルとの比較を行うことで、より適切なモデルを見つけられる可能性があります。
<% if (!test_mode) { %>
* モデルの評価：このモデルの予測性能をより厳密に評価するために、トレーニングデータとテストデータに分けて検証することができます。その場合は、[「設定」](//analytics/settings)より「検証」セクションの下の「テストモード」をTRUEに設定し、実行し直してください。
<% } %>
`;

module.exports = template;