const template = `
# 分析結果

<% if (!repeat_by) { %>

<%= explanatory %>による<%= target %>の中央値の差が有意かどうかを調べました。

{{summary}}

<% if (p > baseline_p) { %>
結果として、P値は<%= p_pct %>% (<%= p %>)で、有意水準<%= baseline_p_pct %>% (<%= baseline_p %>) より大きいため、<%= explanatory %>による<%= target %>の中央値の差は統計的に有意とは言えません。
<% } %>

<% if (p <= baseline_p) { %>
結果として、P値は<%= p_pct %>% (<%= p %>)で、有意水準<%= baseline_p_pct %>% (<%= baseline_p %>) より低いため、<%= explanatory %>による<%= target %>の中央値の差は統計的に有意だと言えます。

  <% if (effect_size < 0.06) { %>
効果量（Eta2乗）は<%= effect_size_pct %>%と低く、<%= explanatory %>による<%= target %>の中央値の差は小さなものです。
  <% } else if (effect_size < 0.14) { %>
効果量（Eta2乗）は<%= effect_size_pct %>%なので、<%= explanatory %>による<%= target %>の中央値の差は中程度です。
  <% } else { %>
効果量（Eta2乗）も<%= effect_size_pct %>%と大きく、<%= explanatory %>による<%= target %>の中央値の差は大きいと言えます。
  <% } %>
<% } %>

<% } else { %>

<%= explanatory %>による<%= target %>の中央値の差が有意かどうかを<%= repeat_by %>ごとに調べました。

{{summary}}

<% if (groups.some(group => group.p <= baseline_p)) { %>
以下のグループにおいては、P値が有意水準<%= baseline_p_pct %>% (<%= baseline_p %>) より低いため、統計的に有意だと言えます。
  <% groups.forEach(group => { %>
    <% if (group.p <= baseline_p) { %>
* <%= group.name %>
    <% } %>
  <% }); %>
<% } %>
<% if (groups.some(group => group.p > baseline_p)) { %>
以下のグループにおいては、P値が有意水準<%= baseline_p_pct %>% (<%= baseline_p %>) より高いため、統計的に有意とは言えません。
  <% groups.forEach(group => { %>
    <% if (group.p > baseline_p) { %>
* <%= group.name %>
    <% } %>
  <% }); %>
<% } %>

<% } %>

この検定における有意水準（P値）は<%= baseline_p_pct %>% (<%= baseline_p %>)に設定されていますが、これはアナリティクスの[「設定」](//analytics/settings)より変更可能です。

{start_show_hide}
## 主要な統計指標

* H値
  * H値はクラスカルウォリス検定の検定統計量で、ランク（順位）に基づいてグループ間の差を数値化したものです。
  * 0以上の値を取り、値が大きいほどグループ間の差が大きいことを示します。
  * 自由度と合わせて解釈し、大きいH値ほどグループ間に意味のある差がある可能性が高まります。

* P値
  * P値は観測されたデータが帰無仮説（グループ間に差がない）と同等かそれ以上に極端である確率を示します。
  * 一般的に5%（0.05）未満であれば、統計的に有意であると判断されます。
  * 値は0から1の間で、P値が小さいほど統計的有意性が高いことを示します。

* 自由度
  * クラスカルウォリス検定での自由度は「グループ数-1」で計算されます。
  * 常に正の整数値を取り、H値とともに検定の有意性を判断する際に使用されます。
  * 自由度が大きいほど、同じH値でも有意性は低くなる傾向があります。

* Eta2乗
  * Eta2乗はノンパラメトリック検定における効果量の指標で、グループによって説明されるランクの変動の割合を示します。
  * 値は0から1の間で、0は効果がないこと、1は全ての変動がグループ間の違いで説明できることを示します。
  * 一般的に0.01は小さい効果、0.06は中程度の効果、0.14以上は大きい効果と解釈されます。

* Epsilon2乗
  * Epsilon2乗はクラスカルウォリス検定での効果量の別の指標で、Eta2乗を修正したものです。
  * 値は0から1の間で、一般的にEta2乗よりも小さい値を示します。
  * サンプルサイズの影響を受けにくいため、異なる研究間の比較に適しています。

* 行数
  * 行数は分析に使用したデータの数（サンプルサイズ）です。
  * データ数が多いほど、小さな差でも検出しやすくなり、結果の信頼性が高まります。
  * クラスカルウォリス検定は分布の正規性を仮定しないため、外れ値がある場合や小さいサンプルサイズでも使用できますが、各グループに最低5つのデータがあることが推奨されます。

{end_show_hide}

# 有意性

有意性については、P値によって判断できます。

## P値

この検定における帰無仮説は「<%= explanatory %>の複数のグループ間で<%= target %>の中央値に差がない」というものです。

<% if (!repeat_by) { %>

<% if (p > baseline_p) { %>
検定の結果、P値が<%= p_pct %>% (<%= p %>)であるため、帰無仮説が正しい場合、今回のデータにおけるクラスカル・ウォリス検定の統計量の値（H値: <%= h_value %>）がたまたま得られる確率が約<%= p_pct %>%と解釈できます。有意水準<%= baseline_p_pct %>% (<%= baseline_p %>) より大きいため、帰無仮説を棄却できません。そのため、<%= explanatory %>による<%= target %>の中央値の差は統計的に有意であると言えません。
<% } %>

<% if (p <= baseline_p) { %>
検定の結果、P値が<%= p_pct %>% (<%= p %>)であるため、帰無仮説が正しい場合、今回のデータにおけるクラスカル・ウォリス検定の統計量の値（H値: <%= h_value %>）がたまたま得られる確率が約<%= p_pct %>%と解釈できます。有意水準が<%= baseline_p_pct %>% (<%= baseline_p %>) 以下であるため、帰無仮説を棄却できます。そのため、<%= explanatory %>による<%= target %>の中央値の差は統計的に有意であると言えます。
<% } %>

確率分布であるH分布（クラスカル・ウォリス分布）のどのあたりにP値（青い点線）が位置するのかを可視化したのが以下のチャートです。H分布は右側検定のため、右側の領域が（帰無仮説の）棄却領域となります。

<% } else { %>

帰無仮説が正しい場合、今回のデータに見られるH値かそれ以上の値がたまたま得られる確率がP値です。有意水準<%= baseline_p_pct %>%より大きければ、帰無仮説を棄却できないため、統計的に有意であるとは言えません。逆に、<%= baseline_p_pct %>%以下であれば、帰無仮説を棄却できるため、統計的に有意であると言えます。

確率分布であるH分布（クラスカル・ウォリス分布）のどのあたりにP値（青い点線）が位置するのかを<%= repeat_by %>ごとに可視化したのが以下のチャートです。H分布は右側検定のため、右側の領域が（帰無仮説の）棄却領域となります。

{{probability_dist}}

現在の有意水準（P値）は<%= baseline_p_pct %>% (<%= baseline_p %>)に設定されていますが、これはアナリティクスの[「設定」](//analytics/settings)より変更可能です。

<% } %>

# 効果量

統計的有意性（P値）はサンプルサイズが大きいと、小さな差でも「有意」と判定されることがあるために、効果量を元にして実際の効果の大きさを評価することができます。この検定では効果量の1つであるEta（イータ）2乗が計算されています。これは、<%= explanatory %>による<%= target %>の平均値のばらつきの大きさの全体のばらつきに対する比率です。

効果量（Eta2乗）の大きさの判断のための目安は以下のとおりです。

| 効果量の値 | 効果量の大きさ |
|------------|------------|
| 0.01 | 小さい効果 |
| 0.06 | 中くらいの効果 |
| 0.14 | 大きい効果 |

<% if (!repeat_by) { %>

<% if (p > baseline_p) { %>
効果量は検定結果において有意と判断した場合に注意する必要がありますが、今回は有意でないため、特に注意する必要はありません。
<% } %>

<% if (p <= baseline_p) { %>
今回の検定結果は有意と判断できるため、効果量に注意する必要があります。
<% } %>

<% } else { %>

効果量は検定結果において有意と判断した場合に注意する必要があります。有意でなければ、特に注意する必要はありません。

<% } %>

# 多重比較

<% if (!repeat_by) { %>

<% if (p > baseline_p) { %>
多重比較分析とは<%= explanatory %>のグループのどの組み合わせにおける<%= target %>の中央値の差が有意なのかを調べるためのものです。全体では<%= explanatory %>による<%= target %>の中央値の差は有意と言えないため、多重比較分析を行う必要はありませんが、参考までに以下がその結果です。

P値が有意水準の5%以下である組み合わせにおける<%= target %>の中央値の差は統計的に有意だと言えます。

{{comparison}}

<% } %>

<% if (p <= baseline_p) { %>

全体では<%= explanatory %>による<%= target %>の中央値の差は有意でした。そこで、多重比較分析として<%= explanatory %>のグループのどの組み合わせにおける<%= target %>の中央値の差が有意なのか調べました。多重比較のために同じような検定を繰り返し何度も行うと、本当は有意でないのに有意であると判断してしまう（タイプ１エラー）確率が上がってしまいます。検定結果には<%= correction %>補正をかけることで、タイプ１エラーの確率を想定内にコントロールしています。

P値が有意水準の5%以下である組み合わせにおける<%= target %>の中央値の差は統計的に有意だと言えます。

{{comparison}}

<% } %>

<% } else { %>

多重比較分析とは<%= explanatory %>のグループのどの組み合わせにおける<%= target %>の中央値の差が有意なのかを調べるためのものです。多重比較のために同じような検定を繰り返し何度も行うと、本当は有意でないのに有意であると間違って判断してしまう確率（タイプ１エラー）が上がってしまいます。そこで検定結果には<%= correction %>補正をかけ、タイプ１エラーの確率をコントロールしています。

有意水準を5%とすると、P値がその値よりも小さい組み合わせが統計的に有意なものとなります。

{{comparison}}

<% } %>

# 記述統計情報

## 統計量

それぞれのグループごとの統計値は以下の通りです。

{{statistics}}

## データの分布

<%= explanatory %>による<%= target %>の分布の違いを密度曲線を使って可視化したものが以下となります。

{start_lazy_show_hide}
### チャート
{{distribution}}
{end_lazy_show_hide}

## 平均値の信頼区間

それぞれのグループごとの平均の信頼区間をエラーバーを使って可視化したものが以下となります。

{start_lazy_show_hide}
### チャート
{{mean}}
{end_lazy_show_hide}

# 補足情報

## 次のステップ

* 今回は<%= target %>に対する<%= explanatory %>という1つの変数が与える影響を分析しました。しかし、他の変数も<%= target %>に影響している可能性があります。そのため、「線形回帰」などを使った多変量分析を使い、複数の要因を同時に考慮した分析をすることができます。
<% if (!repeat_by) { %>
* 今回の検定は全体に対して行われましたが、グループごとに分けて実施することも可能です。その場合は、「繰り返し」にグループとなる変数を選択し、実行し直すことができます。
<% } %>
* 複数の指標をまとめて一括で検定を行いたい場合、データの形を変更することで可能です。詳細については、[こちら](https://exploratory.io/note/exploratory/mxW2zKb2)のノートをご覧ください。

`;

module.exports = template;