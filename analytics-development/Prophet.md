const template = `
<br/>
<!-- intentional new line feed above -->

<% if (!test_mode) { %>
<%= target %> を予測するモデルが作られました。<%= period %><%= unit %>後までを予測していますが、こちらの予測期間は[「設定」](//analytics/settings)の「予測期間」より変更できます。
<% } else { %>
<%= target %> を予測するモデルが作られました。現在テストモードであるため、データの最後から<%= test_period %><%= unit %>前までのデータを使ってモデルを作り、それ以降の期間（テスト期間）に対して予測しています。テスト期間はアナリティクスの[「設定」](//analytics/settings)の「テストデータの期間」のセクションより変更できます。
<% } %>

<!-- 外部予測変数があり予測期間に0より大きい値が設定されている場合はこのセクションを表示 -->
<% if (has_external_regressors && period > 0) { %>

**外部予測変数と将来の予測について**

このモデルには外部予測変数が含まれていますが、外部予測変数の将来のデータが含まれていないため、将来の期間における予測はできません。外部予測変数のデータが存在する期間に対しての予測は行われているため、<%= target %>と外部予測変数の間の相関関係を調べることができます。

Prophetで外部予測変数を使用したモデルで将来の予測をしたい場合は、外部予測変数の将来の期間のデータを用意してください。

<% } %>

# 予測結果

<% if (!test_mode) { %>
予測された値をオレンジの線、実測値を青い線で可視化したのが以下のチャートです。
<% } else { %>
予測された値をオレンジの線、トレーニング期間の実測値を青い線、テスト期間の実測値を水色の線で可視化したのが以下のチャートです。
<% } %>

{{forecast_chart}}

予測された値を表すオレンジの線の上下の薄いオレンジの領域は、不確実性区間となります。

# トレンド

Prophetモデルがデータより読み取った<%= target %>の長期的なトレンド（傾向）を可視化したのが以下のチャートです。このグラフには以下の要素が含まれています：

<% if (!test_mode) { %>
- 青い線：<%= target %>の実測値です。
- 緑の線：実測値から季節性や不規則な変動を取り除いたトレンドを表しています。変化点によりトレンドの傾きは変わります。
- 赤いバー：トレンドの変化点を表し、<%= target %>の動きが大きく変わったことを示します。
<% } else { %>
- 青い線：トレーニング期間の<%= target %>の実測値です。
- 水色の線：テスト期間の<%= target %>の実測値です。
- 緑の線：実測値から季節性や不規則な変動を取り除いたトレンドを表しています。変化点によりトレンドの傾きは変わります。
- 赤いバー：トレンドの変化点を表し、<%= target %>の動きが大きく変わったことを示します。
<% } %>

{{trend_chart}}

<!-- 年周期がある場合にのみ表示 -->
<% if (has_yearly_seasonality) { %>

## 年周期の季節性

データの中で毎年繰り返される<%= target %>の「年周期」のパターンです。<%= target %>が1年を通じてどのように変動するかを見ることができます。

{{yearly_seasonality_chart}}

<% } %>

<!-- 四半期周期がある場合にのみ表示 -->
<% if (has_quarterly_seasonality) { %>

## 四半期周期の季節性

データの中で毎四半期繰り返される<%= target %>の「四半期周期」のパターンです。<%= target %>が四半期を通じてどのように変動するかを見ることができます。

{{quarterly_seasonality_chart}}

<% } %>

<!-- 月周期がある場合にのみ表示 -->
<% if (has_monthly_seasonality) { %>

## 月周期の季節性

データの中で毎月繰り返される<%= target %>の「月周期」のパターンです。<%= target %>が月を通じてどのように変動するかを見ることができます。

{{monthly_seasonality_chart}}

<% } %>


<!-- 週周期がある場合にのみ表示 -->
<% if (has_weekly_seasonality) { %>

## 週周期の季節性

データの中で毎週繰り返される<%= target %>の「週周期」のパターンです。<%= target %>が1週間を通じてどのように変動するかを見ることができます。

{{weekly_seasonality_chart}}

<% } %>

<!-- 日周期がある場合にのみ表示 -->
<% if (has_daily_seasonality) { %>

## 日周期の季節性

データの中で毎日繰り返される<%= target %>の「日周期」のパターンです。<%= target %>が1日を通じてどのように変動するかを見ることができます。

{{daily_seasonality_chart}}

<% } %>

# 時系列要素の分析

<!-- 外部予測変数が選ばれているときのみ表示 -->
<% if (has_external_regressors) { %>
## 変数の重要度

季節性や選択された外部予測変数が、<%= target %>を予測するのにどれだけ重要なのかを相対的に表したのが以下のチャートです。

{{variable_importance}}

変数の重要度の仕組みについては、[こちら](https://exploratory.io/note/exploratory/dLm5rwn5)のノートをご覧ください。

<% } %>

## 時系列要素と予測値の関係

このProphetモデルは<%= target %>のデータを以下の要素に分解して予測に使用しています。

* トレンド
* 季節性: <%= seasonalities.map(seasonality => seasonality).join(', ') %>
<% if (has_external_regressors) { %>
* 外部予測変数: <%= external_regressors.map(regressor => regressor.name).join(', ') %>
<% } %>

これらの要素がを足し上げたものが、予測値とするのがProphetモデルです。グレーの線が予測値を表しますが、この線の形により近い形を線の要素は、Prophetモデルによる予測により大きな貢献をしているということを示します。

{{effect_chart}}

# 予測精度

<% if (!test_mode) { %>
トレーニングデータに対するモデルの予測精度に関する様々な指標を以下の表にまとめています。
<% } else { %>
現在テストモードであるため、テストデータに対するモデルの予測精度に関する様々な指標を以下の表にまとめています。
<% } %>

{{summary}}

<% if (!repeat_by) { %>

主な評価指標は以下の通りです。

* RMSE（ルート平均2乗誤差）: 予測値と実測値の差は平均して<%= rmse %>ほどです。値が小さいほど予測精度が高いことを示します。
* MAE（平均絶対誤差）:  予測値と実測値の差（絶対値）は平均して<%= mae %>ほどです。値が小さいほど予測精度が高いことを示します。
* MAPE（平均絶対誤差率）: 予測値と実測値の差（絶対値）は実測値に対して<%= mape_pct %>%ほどです。値が小さいほど予測精度が高いことを示します。
* R2乗値: このモデルは<%= target %>のばらつきの<%= r_squared_pct %>%を説明できています。

<% } %>

{start_show_hide}
<% if (!test_mode) { %>
## モデルの指標の説明

* RMSE（Root Mean Square Error）
  * RMSEは平均二乗誤差の平方根を表し、予測値と実測値の誤差の大きさを測定します。
  * 目的変数と同じ単位で表されるため解釈しやすく、値が小さいほど予測精度が高いことを意味します。
  * 0以上の値を取り、完璧な予測であれば0になります。

* MAE（Mean Absolute Error）
  * MAEは平均絶対誤差を表し、予測値と実測値の差の絶対値の平均を示します。
  * 目的変数と同じ単位で表され、値が小さいほど予測精度が高いことを意味します。
  * 0以上の値を取り、完璧な予測であれば0になります。

* MAPE（Mean Absolute Percentage Error）
  * MAPEは平均絶対パーセント誤差を表し、予測値と実測値の差を実測値で割った値の絶対値の平均をパーセント表示したものです。
  * 値は0%以上で、0%に近いほど予測精度が高いことを意味します。
  * 一般的に10%未満で高精度、10-20%で良好、20%以上で改善が必要と解釈されることが多いです。
  * 異なるグループと予測精度を比較する際に使用されることが多いです。

* R2乗
  * R2乗は目的変数の値のばらつきのうち、このモデルによって説明される割合を示します。
  * 値は一般的に0から1の間で、1はモデルが完全に目的変数の値を予測できることを意味します。
  * 時系列予測においては、トレンドや季節性パターンをどの程度捉えられているかの指標となります。
  * 一般的に0.8以上で非常に高い、0.6～0.8で高い、0.4～0.6で中程度、0.2～0.4で低い、0.2未満で非常に低いモデル適合度と解釈されることが多いです。

<% } else { %>

## モデルの指標の説明

* RMSE（Root Mean Square Error）
  * RMSEは平均二乗誤差の平方根を表し、予測値と実測値の誤差の大きさを測定します。
  * 目的変数と同じ単位で表されるため解釈しやすく、値が小さいほど予測精度が高いことを意味します。
  * 0以上の値を取り、完璧な予測であれば0になります。

* MAE（Mean Absolute Error）
  * MAEは平均絶対誤差を表し、予測値と実測値の差の絶対値の平均を示します。
  * 目的変数と同じ単位で表され、値が小さいほど予測精度が高いことを意味します。
  * 0以上の値を取り、完璧な予測であれば0になります。

* MAPE（Mean Absolute Percentage Error）
  * MAPEは平均絶対パーセント誤差を表し、予測値と実測値の差を実測値で割った値の絶対値の平均をパーセント表示したものです。
  * 値は0%以上で、0%に近いほど予測精度が高いことを意味します。
  * 一般的に10%未満で高精度、10-20%で良好、20%以上で改善が必要と解釈されることが多いです。
  * 異なるグループと予測精度を比較する際に使用されることが多いです。

* MASE（Mean Absolute Scaled Error）
  * MASEは平均絶対スケール誤差を表し、予測誤差をベースライン予測（通常はナイーブ予測）の誤差で割った値です。
  * 値が1未満であれば提案モデルがベースラインより優秀、1以上であればベースラインより劣ることを意味します。
  * 季節性のあるデータでは特に有用で、異なる時系列データ間での予測性能比較に適しています。
  * スケールに依存しないため、異なる単位のデータセット間での比較が可能です。

* R2乗
  * R2乗は目的変数の値のばらつきのうち、このモデルによって説明される割合を示します。
  * 値は一般的に0から1の間で、1はモデルが完全に目的変数の値を予測できることを意味します。
  * 時系列予測においては、トレンドや季節性パターンをどの程度捉えられているかの指標となります。
  * 一般的に0.8以上で非常に高い、0.6～0.8で高い、0.4～0.6で中程度、0.2～0.4で低い、0.2未満で非常に低いモデル適合度と解釈されることが多いです。

<% } %>
{end_show_hide}

## 予測データ

<% if (!test_mode) { %>
予測結果を元のデータに加えたものが以下の表となります。
<% } else { %>
トレーニングデータとテストデータに対して、作成された予測モデルを使って予測した結果が以下の表となります。
<% } %>

{start_lazy_show_hide}
### データ
{{data}}
{end_lazy_show_hide}

# 補足情報

## 次のステップ

* 予測期間の最適化: より短期の予測に焦点を当てることで、予測精度を向上させることができる可能性があります。
* Prophetで予測をする際には、異常値（外れ値）への対応、必要なデータの期間、祝日効果の設定、外部予測変数の将来の期間のデータ、などといったデータに関する注意点があります。これらの問題と解決方法については、[こちら](https://exploratory.io/note/exploratory/Prophet-kEu1dMb1)のノートをご覧ください。
<% if (!test_mode) { %>
* モデルの評価：このモデルの予測性能をより厳密に評価するために、トレーニングデータとテストデータに分けて検証することができます。その場合は、[「設定」](//analytics/settings)より「検証」セクションの下の「テストモード」をTRUEに設定し、実行し直してください。
<% } %>

`;

module.exports = template;
