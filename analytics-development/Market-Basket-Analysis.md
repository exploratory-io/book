const template = `
# 分析結果

「バスケット」の中にある「アイテム」の中で出現頻度が高い組み合わせのパターンや、その組み合わせの関係の深さを調べました。

以下のテーブルは、アイテム間のルールを一覧で表示しています。

{{data}}

**解釈の例**

* <%= item1 %> → <%= pair_item1 %>
    * <%= item1 %>と<%= pair_item1 %>が同時に選択される頻度は他に比べて高いです。
    * <%= item1 %>と<%= pair_item1 %>が同時に選択される割合は、全データの中の<%= support1_pct %>%です。
    * <%= item1 %>が選択される場合、そのうち約<%= confidence1_pct %>%が<%= pair_item1 %>も一緒に選択されます。
    * <%= item1 %>が選択された場合、<%= pair_item1 %>が選択される確率が通常の<%= lift1 %>倍になることを示しています。

* <%= item2 %> → <%= pair_item2 %>
    * <%= item2 %>と<%= pair_item2 %>が同時に選択される頻度は他に比べて高いです。
    * <%= item2 %>と<%= pair_item2 %>が同時に選択される割合は、全データの中の<%= support2_pct %>%です。
    * <%= item2 %>が選択される場合、そのうち約<%= confidence2_pct %>%が<%= pair_item2 %>も一緒に選択されます。
    * <%= item2 %>が選択された場合、<%= pair_item2 %>が選択される確率が通常の<%= lift2 %>倍になることを示しています。

* <%= item3 %> → <%= pair_item3 %>
    * <%= item3 %>と<%= pair_item3 %>が同時に選択される頻度は他に比べて高いです。
    * <%= item3 %>と<%= pair_item3 %>が同時に選択される割合は、全データの中の<%= support3_pct %>%です。
    * <%= item3 %>が選択される場合、そのうち約<%= confidence3_pct %>%が<%= pair_item3 %>も一緒に選択されます。
    * <%= item3 %>が選択された場合、<%= pair_item3 %>が選択される確率が通常の<%= lift3 %>倍になることを示しています。

マーケット・バスケット分析では、支持度、確信度、リフトの3つの指標をもとに判断をします。

**支持度（Support）**

* 支持度とは、全てのデータ（バスケット）の中で、特定の組み合わせが一緒に選択された割合を表す指標です。
* これは「その組み合わせがどのくらいよくあるか」を示すもので、全体に占める割合で表されます。
* 支持度が高いほど、その組み合わせは全体のデータに占める割合が大きいということになります。


<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <mtext>支持度</mtext>
    <mo>=</mo>
    <mfrac>
      <mtext>特定の組み合わせの出現回数</mtext>
      <mtext>全てのデータ（バスケット）</mtext>
    </mfrac>
  </mrow>
</math>

**確信度（Confidence）**
* ある商品Aを選択した人のうち、どれくらいの割合で商品Bも一緒に選択されているかを表す指標です。
* これは「Aを選択していたら、どのくらいの確率でBも選択しているか」という条件付きの割合を示し、確信度が高いほど「Aを選択する人は高い確率でBも選択している」と判断できます。

<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <mtext>確信度</mtext>
    <mo>=</mo>
    <mfrac>
      <mtext>商品AとBを選択した数</mtext>
      <mtext>商品Aが選択された数</mtext>
    </mfrac>
  </mrow>
</math>

**リフト（Lift）**

* リフトは商品Aの選択によって商品Bを選択する確率が、商品B全体での選択率より何倍高まるかを示したものです。
* リフトは商品Aを選択した数における商品Bの選択率（確信度）を、全体における商品Bの選択率（商品Bの支持度）で割ることで求められます。
* この値によって、確信度が高い組み合わせが本当に関連性が強いのか、それとも単にBがよく選択されるものなのでたまたま一緒に選択されているだけなのかを判断できます。

<math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
  <mrow>
    <mtext>リフト</mtext>
    <mo>=</mo>
    <mfrac>
      <mtext>確信度</mtext>
      <mtext>商品Bの支持度</mtext>
    </mfrac>
  </mrow>
</math>

## グラフ

以下のネットワーク図は、「アイテム」の中で出現頻度が高い組み合わせのパターンや、その組み合わせの関係の深さを視覚的に表したものです。

{{graph}}

**グラフの読み方**:

* 丸い点（ノード）は「アイテム」を表し、アイテムから伸びる線を踏まえると「アイテム同士の組み合わせ」を表します。
* 線は組み合わせ（どのアイテムが他のアイテムと一緒に選択されるか）の傾向を示しています。
* 矢印の向きは方向を示し、始点のアイテムがあると終点のアイテムも選ばれやすいことを表しています。
* 点の大きさは「その組み合わせの出現頻度（支持度）」を表し、大きいほど出現頻度（確率）が高い組み合わせであることを意味します。
* 点の色は「一緒に選ばれる確実さ（確信度）」を表し、色が濃いほど「一方があれば他方も選ばれる可能性が高い」ことを示します。

## 散布図

以下の散布図は、アイテムの組み合わせ（ルール）を「支持度」と「確信度」と「リフト値」の3つの指標で表示しています。

{{scatter_plot}}

**散布図の読み方**:

* サークル（丸い点）は、1つのルール（アイテムの組み合わせパターン）を表しています。
* X軸（横軸）は「支持度」を表し、その組み合わせの出現確率を示しています。
* Y軸（縦軸）は「確信度」を表し、色が濃いほど「始点のアイテムがあれば終点のアイテムも共に選ばれる可能性が高い」ことを示します。
* サークルの大きさは「リフト」を表し、大きいほど「始点のアイテムがあると、終点のアイテムが選ばれる確率がどれだけ押し上げられるか」を表します。1より大きいほど相乗効果が強いことを意味します。

**グラフの各領域の解釈**:

* 右上の領域（高支持度・高確信度）
  - 大きな円: 登場頻度が多い組み合わせで、強い関連性と高い相乗効果を持つ「最重要ルール」
  - 小さな円: 登場頻度が多い組み合わせで、強い関連性があるが、相乗効果は限定的な「安定パターン」

* 左上の領域（低支持度・高確信度）
  - 大きな円: 登場頻度が少ない組み合わせで、起きると非常に強い相乗効果を持つ「隠れた宝石」
  - 小さな円: 登場頻度は少ない組み合わせだが、一定の関連性がある「ニッチなパターン」

* 右下の領域（高支持度・低確信度）
  - 大きな円: 登場頻度が多い組み合わせで相乗効果も見られる「注目すべき一般パターン」
  - 小さな円: 登場頻度は多い組み合わせだが、特別な関連性は弱い「当たり前のパターン」

* 左下の領域（低支持度・低確信度）
  - 大きな円: 登場頻度が少ない組み合わせだが、予想外の相乗効果がある「意外な発見」
  - 小さな円: 重要性が低く、偶然の可能性が高いルール

`;

module.exports = template;