const template = `
# サマリ

<% if (!repeat_by) { %>

<%= target %>と<%= explanatory %>の関係が有意かどうかを調べました。

{{summary}}

<% if (p > baseline_p) { %>
結果として、P値は<%= p_pct %>% (<%= p %>)で、有意水準<%= baseline_p_pct %>% (<%= baseline_p %>) より大きいため、<%= target %>と<%= explanatory %>の関係は統計的に有意とは言えません。

  <% if (power < 0.5) { %>
ただ、検出力は<%= power_pct %>% (<%= power %>)と低く、もし実際に差があったとしても、見逃す確率（タイプ２エラー）が<%= 100 - power_pct %>% (<%= power %>)と非常に高いため注意が必要です。
  <% } else { %>
ただ、検出力は<%= power_pct %>% (<%= power %>)と低めであり、もし実際に差があったとしても、見逃す確率（タイプ２エラー）が<%= 100 - power_pct %>% (<%= power %>)もあるため注意が必要です。
  <% } %>
<% } %>

<% if (p <= baseline_p) { %>
結果として、P値は<%= p_pct %>% (<%= p %>)で、有意水準<%= baseline_p_pct %>% (<%= baseline_p %>) より低いため、<%= target %>と<%= explanatory %>の関係は統計的に有意だと言えます。

  <% if (effect_size < 0.1) { %>
効果量（Cramer's V）は<%= effect_size %>と低く、<%= target %>と<%= explanatory %>の関係は小さなものです。
  <% } else if (effect_size < 0.3) { %>
効果量は<%= effect_size %>なので、<%= target %>と<%= explanatory %>の関係は中程度です。
  <% } else { %>
効果量も<%= effect_size %>と大きく、<%= target %>と<%= explanatory %>の関係は大きいと言えます。
  <% } %>
<% } %>

<% } else { %>

<%= target %>と<%= explanatory %>の関係が有意かどうかを<%= repeat_by %>ごとに調べました。

{{summary}}

<% if (groups.some(group => group.p <= baseline_p)) { %>
以下のグループにおいては、P値が有意水準<%= baseline_p_pct %>% (<%= baseline_p %>) より低いため、統計的に有意だと言えます。
  <% groups.forEach(group => { %>
    <% if (group.p <= baseline_p) { %>
* <%= group.name %>
    <% } %>
  <% }); %>
<% } %>
<% if (groups.some(group => group.p > baseline_p)) { %>
以下のグループにおいては、P値が有意水準<%= baseline_p_pct %>% (<%= baseline_p %>) より高いため、統計的に有意とは言えません。
  <% groups.forEach(group => { %>
    <% if (group.p > baseline_p) { %>
* <%= group.name %>
    <% } %>
  <% }); %>
<% } %>

<% } %>

この検定における有意水準（P値）は<%= baseline_p_pct %>% (<%= baseline_p %>)に設定されていますが、これはアナリティクスの[「設定」](//analytics/settings)より変更可能です。

{start_show_hide}
## 統計指標の説明
* カイ2乗値
  * カイ2乗値は観測値と期待値の差を測定する統計量で、カテゴリデータの関連性を評価するために使用されます。
  * 値は0以上で、0は観測値と期待値が完全に一致することを意味します。値が大きいほど、観測値と期待値の差が大きいことを示します。
  * 一般的に、P値と組み合わせて解釈され、カイ2乗値自体には絶対的な基準値はありません。

* P値
  * P値は観測されたデータが帰無仮説（変数間に関連性がない）と同等かそれ以上に極端である確率を示します。
  * 一般的に5%（0.05）未満であれば、統計的に有意であると判断されます。
  * 値は0から1の間で、P値が小さいほど統計的有意性が高いことを示します。

* 自由度
  * カイ2乗検定での自由度は、データの分類方法により決まり、一般的には「(行の数-1)×(列の数-1)」で計算されます。
  * 常に正の整数値を取り、値が大きいほどデータ間の複雑な関係を捉えられます。
  * 自由度はカイ2乗値を解釈する際の基準となり、同じカイ2乗値でも自由度が大きいと有意性は低くなります。

* Phi（ファイ係数）
  * Phi係数は2×2の分割表（2つの二値変数の関係）における関連の強さを示す指標です。
  * 値は-1から+1の間を取り、0は関連がないことを示し、±1に近いほど強い関連があることを示します。
  * 一般的に±0.1は弱い関連、±0.3は中程度の関連、±0.5以上は強い関連と解釈されます。

* Cramer's V（クラメールのV）
  * Cramer's Vは2×2より大きい分割表での関連の強さを示す指標で、Phi係数を拡張したものです。
  * 値は0から1の間を取り、0は関連がないことを示し、1に近いほど強い関連があることを示します。
  * 一般的に0.1は弱い関連、0.3は中程度の関連、0.5以上は強い関連と解釈されます。

* Cohen's W（コーエンのW）
  * Cohen's Wは効果量の指標で、カイ2乗検定におけるサンプルサイズに影響されない効果の大きさを示します。
  * 値は0から無限大までの範囲を取り、0.1は小さい効果、0.3は中程度の効果、0.5以上は大きい効果と解釈されます。
  * 異なるサンプルサイズの研究間で効果の大きさを比較する際に有用です。

* 検出力
  * 検出力は実際に効果がある場合に、それを統計的に検出できる確率を表します。
  * 値は0から1の間で、一般的には0.8（80%）以上が望ましいとされています。
  * 検出力が低い場合、実際に存在する効果を見逃している可能性があることを示します。

* タイプ2エラー
  * タイプ2エラーは「実際には効果があるのに、ないと判断してしまう確率」です。
  * 値は0から1の間で、検出力 = 1 - タイプ2エラーの関係があります。
  * 一般的には0.2（20%）以下が望ましいとされています。

* 行数
  * 行数は分析に使用したデータの総数（サンプルサイズ）を示します。
  * サンプルサイズが大きいほど、統計的検定の検出力が高まり、結果の信頼性が向上します。
  * 検定の種類や効果量によって、必要なサンプルサイズは異なります。
{end_show_hide}

# 有意性

有意性については、P値によって判断できます。

{{summary}}

## 有意性 - P値

この検定における帰無仮説は「<%= target %>と<%= explanatory %>は関係がない」というものです。

<% if (!repeat_by) { %>

<% if (p > baseline_p) { %>
検定の結果、P値が<%= p_pct %>% (<%= p %>)となりました。これは、もし帰無仮説が正しいのであれば、<%= target %>の<%= explanatory %>のそれぞれのグループごとの割合が今回のデータのように違う確率が約<%= p_pct %>%であるということです。有意水準が<%= baseline_p_pct %>% (<%= baseline_p %>) の場合、この確率は十分に高いので、帰無仮説を棄却できません。つまり、<%= target %>と<%= explanatory %>の関係は統計的に有意であると言えません。
<% } %>

<% if (p <= baseline_p) { %>
検定の結果、P値が<%= p_pct %>% (<%= p %>)となりました。これは、もし帰無仮説が正しいのであれば、<%= target %>のそれぞれのグループにおける<%= explanatory %>のそれぞれのグループごとの割合が今回のデータのように違う確率は約<%= p_pct %>%>しかないということです。有意水準が<%= baseline_p_pct %>% (<%= baseline_p %>) の場合、この確率は十分に低いので、帰無仮説を棄却できます。つまり、<%= target %>と<%= explanatory %>の関係は統計的に有意であると言えます。
<% } %>

確率分布であるカイ二乗分布のどのあたりにP値（青い点線）が位置するのかを可視化したのが以下のチャートです。カイ二乗分布は右側検定のため、右側の領域が（帰無仮説の）棄却領域となります。

<% } else { %>

帰無仮説が正しい場合、<%= target %>と<%= explanatory %>のグループごとの割合が今回のデータのように違うかそれ以上に違う確率がP値です。有意水準<%= baseline_p_pct %>%より大きければ、帰無仮説を棄却できないため、統計的に有意であるとは言えません。逆に、<%= baseline_p_pct %>%以下であれば、帰無仮説を棄却できるため、統計的に有意であると言えます。

確率分布であるカイ二乗分布のどのあたりにP値（青い点線）が位置するのかを、<%= repeat_by %>ごとに可視化したのが以下のチャートです。カイ二乗分布は右側検定のため、右側の領域が（帰無仮説の）棄却領域となります。

{{probability_dist}}

現在の有意水準（P値）は<%= baseline_p_pct %>% (<%= baseline_p %>)に設定されていますが、これはアナリティクスの[「設定」](//analytics/settings)より変更可能です。

# 効果量

統計的有意性（P値）はサンプルサイズが大きいと、小さな差でも「有意」と判定されることがあるために、効果量を元にして実際の効果の大きさを評価することができます。この検定では効果量であるCramer's Vが計算されています。これは、<%= target %>と<%= explanatory %>の関係の大きさを標準化したものです。

効果量（Cramer's V）の大きさの判断のための目安は以下のとおりです。

| 効果量の値 | 効果量の大きさ |
|------------|------------|
| 0.1 | 小さい効果 |
| 0.3 | 中くらいの効果 |
| 0.5 | 大きい効果 |

<% if (!repeat_by) { %>

<% if (p > baseline_p) { %>
効果量は検定結果において有意と判断した場合に注意する必要がありますが、今回は有意でないため、特に注意する必要はありません。
<% } %>

<% if (p <= baseline_p) { %>
今回の検定結果は有意と判断できるため、効果量に注意する必要があります。
<% } %>

<% } else { %>

効果量は検定結果において有意と判断した場合に注意する必要があります。有意でなければ、特に注意する必要はありません。

<% } %>

## 検出力

検出力は、実際に<%= target %>と<%= explanatory %>の間に関係があった場合、それを正しく検出できる確率のことです。この検出力の逆がタイプ２エラーで、これは有意でないと判断したときに間違っている確率、つまり本当は有意であった（関係があった）かもしれない確率のことです。一般的に検出力は80% (0.8) 以上あるのが望ましいとされています。それよりも低い場合には注意が必要です。

<% if (!repeat_by) { %>

<% if (p > baseline_p) { %>

<% if (power < 0.5) { %>
検出力は<%= power_pct %>% (<%= power %>)と低い値になっています。これは、もし実際に<%= target %>と<%= explanatory %>の間に関係があったとしても、それを正しく検出できる確率が約<%= power_pct %>%しかないということです。言い換えると、**本当は関係があるのに「関係がない」と誤って結論づけてしまう確率（タイプ２エラー）が<%= 100 - power_pct %>% (<%= 1 - power %>)**もあるということなので、有意なのかどうかの判断が困難となります。
<% } else if (power < 0.8) { %>
検出力は<%= power_pct %>% (<%= power %>)とやや低めになっています。これは、もし実際に<%= target %>と<%= explanatory %>の間に関係があったとしても、それを正しく検出できる確率が約<%= power_pct %>%しかないということです。言い換えると、**本当は関係があるのに「関係がない」と誤って結論づけてしまう確率（タイプ２エラー）が<%= 100 - power_pct %>%**もあるということなので、慎重な判断が必要です。
<% } else { %>
検出力は<%= power_pct %>% (<%= power %>)と十分に高いため、特に問題はありません。
<% } %>

<% } else { %>
今回は、有意と判断できるため特に注意する必要はありません。
<% } %>

検出力、およびタイプ２エラーは検定結果を元に有意でないと判断した場合に注意する必要があります。逆に、もし関係が有意であると判断した場合は、特に注意する必要はありません。

<% } else { %>

検出力、およびタイプ２エラーは検定結果を元に有意でないと判断した場合に注意する必要があります。逆に、もし関係が有意であると判断した場合は、特に注意する必要はありません。

<% } %>

# 記述統計情報

## 割合（表）

<%= target %>のそれぞれのグループにおける<%= explanatory %>のそれぞれのグループごとの割合を表形式で表したものが以下となります。

### チャート
{{pivot}}

## 割合（チャート）

<%= target %>のそれぞれのグループにおける<%= explanatory %>のそれぞれのグループごとの割合をバーチャートを使って可視化したものが以下となります。

{start_lazy_show_hide}
### チャート
{{ratio}}
{end_lazy_show_hide}

## カイ2乗値への寄与度

<%= target %>と<%= explanatory %>のそれぞれのグループの組み合わせが、全体の「ズレ」の指標であるカイ2乗値に寄与する割合を可視化したものが以下となります。円の色の濃淡は寄与度（率）を示し、濃い青であるほどその組み合わせは他の組み合わせに比べてより大きな「ズレ」があると解釈できます。円の大きさはデータ量を表し、大きい円であるほどその組み合わせにより多くのデータがあると解釈できます。

{start_lazy_show_hide}
### チャート
{{contribution}}
{end_lazy_show_hide}

# 次のステップ

<% if (is_target_logical) { %>
* 今回は<%= target %>に対する<%= explanatory %>という1つの変数が与える影響を分析しました。しかし、他の変数も<%= target %>に影響している可能性があります。そのため、「ロジスティック回帰」などを使った多変量分析を使い、複数の要因を同時に考慮した分析をすることができます。
<% } %>
<% if (!repeat_by) { %>
* 今回の検定は全体に対して行われましたが、グループごとに分けて実施することも可能です。その場合は、「繰り返し」にグループとなる変数を選択し、実行し直すことができます。
<% } %>

`;

module.exports = template;
